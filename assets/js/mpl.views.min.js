!function(e){"undefined"==typeof mpl&&(window.mpl={}),e().extend(mpl.views,{builder:new mpl.backbone.views("no-model").extend({render:function(){var l=e(mpl.template("container"));return e("#mpl-container").remove(),e("#postdivrich").hide().removeClass("first-load").after(l),this.el=l,l},events:{".basic-add:click":mpl.backbone.add,".mpl-add-sections:click":"sections",".post-settings:click":"post_settings",".optimized-page:click":"optimized",".save-page-content:click":"save_page",".collapse:click":"collapse","#mpl-footers li.quickadd:click":"footer",".front-editor:click":"jump"},sections:function(e,l){e.preventDefault();var t={title:mpl.__.i61,width:1024,float:!0,class:"no-footer bg-blur-style section-manager-popup"},o=mpl.tools.popup.render(e.target,t);return"object"!=typeof l&&(l={}),void 0!==l.save_row&&(o.data({model:l.save_row}),o.addClass("mpl-save-row-to-section")),void 0!==l.current&&void 0!==l.model&&o.data({model:l.model,current_item:l.current}),void 0===mpl.sections||0===mpl.sections.items.length?(o.find(".m-p-body").append('<p class="align-center" style="height:100px;"></p>'),mpl.ui.sections.reload(o)):mpl.ui.sections.render(o),o},online_sections:function(e){return""},post_settings:function(l){var t={title:"Page Settings",width:800,class:"no-footer bg-blur-style"},o=mpl.tools.popup.render(l.target,t),n=mpl.tools.reIndexForm(e("input[name^='mpl_post_meta']").serializeArray(),[]).mpl_post_meta,i=e(mpl.template("post-settings",n));return o.find(".m-p-body").append(i),"function"==typeof n.callback&&n.callback(i,e),!1},optimized:function(l){var t={title:"Optimize Settings",width:800,class:"no-footer bg-blur-style"},o=mpl.tools.popup.render(l.target,t),n=mpl.tools.reIndexForm(e("input[name^='mpl_post_meta']").serializeArray(),[]).mpl_post_meta,i=e(mpl.template("optimized-settings",n));return o.find(".m-p-body").append(i),"function"==typeof n.callback&&n.callback(i,e),!1},collapse:function(l){var t=e(this).closest("#mpl-container");return t.hasClass("collapse")?(t.removeClass("collapse"),e("#mpl-page-cfg-collapsed").val("")):(t.addClass("collapse"),e("#mpl-page-cfg-collapsed").val("collapse")),l.preventDefault(),!1},footer:function(){var l=e(this).data("content");if("custom"==l){var t={title:mpl.__.i36,width:750,float:!0,class:"push-custom-content",save_text:"Push to builder"},o=mpl.tools.popup.render(this,t),n=mpl.backbone.stack.get("MPL_RowClipboard");return void 0!==n&&""!=n||(n=""),o.find(".m-p-body").html(mpl.__.i37+'<p></p><textarea style="width: 100%;height: 300px;">'+n+"</textarea>"),void o.data({callback:function(e){var l=e.find("textarea").val();""!==l&&mpl.backbone.push(l)}})}"paste"==l&&(void 0!==(l=mpl.backbone.stack.get("MPL_RowClipboard"))&&""!=l||(l="[mpl_column_text]<p>"+mpl.__.i38+"</p>[/mpl_column_text]")),""!=l&&mpl.backbone.push(l)},save_page:function(e){return mpl.views.builder.sections(e,{save_row:"all"}),!1},jump:function(){return window.open(mpl_current_url),!1}}),views_sections:(new mpl.backbone.views).extend({render:function(l){var t=new e(mpl.template("views-sections",l));return mpl.params.process_all(l.args.content,t.find("> .mpl-views-sections-wrap"),"views_section"),this.el=t,t},events:{">.mpl-views-sections-control .edit:click":"settings",">.mpl-views-sections-control .delete:click":"remove",">.mpl-views-sections-control .double:click":"double",">.mpl-views-sections-wrap .add-section:click":"add_section",">.mpl-views-sections-control .more:click":"more",">.mpl-views-sections-control .copy:click":"copy",">.mpl-views-sections-control .cut:click":"cut",">.mpl-views-sections-control:click":function(l){var t=e(l.target);t.hasClass("more")||t.parent().hasClass("more")||e(this).find(".active").removeClass("active")}},add_section:function(e){e.data.do_add_section(this)},do_add_section:function(l){var t=e(l).closest(".mpl-views-sections-wrap"),o=mpl.get.maps(l),n=mpl.maps[o.views.sections],i="["+o.views.sections+' title="New '+n.name+'"][/'+o.views.sections+"]";t.find("> .mpl-views-sections-label .sl-active").removeClass("sl-active"),t.find("> .mpl-section-active").removeClass("mpl-section-active"),mpl.params.process_all(i,t,"views_section")}}),views_section:(new mpl.backbone.views).extend({render:function(l){var t=e(mpl.template("views-section",l));return this.el=t,t},init:function(e,l){var t=l.data("model"),o=e.parent_wrp.find(">.mpl-views-sections-label .add-section"),n=mpl.tools.esc(e.args.title),i="";void 0!=e.args.icon&&(i='<i class="'+e.args.icon+'"></i> '),mpl.ui.sortInit();var s='<div class="section-label';return 1==e.first&&(s+=" sl-active"),s+='" id="mpl-pmodel-'+t+'" data-pmodel="'+t+'">'+i+n+"</div>",o.before(s),o},events:{">.mpl-vs-control .settings:click":"settings",">.mpl-vs-control .double:click":"double",">.mpl-vs-control .add:click":"add",">.mpl-vs-control .delete:click":"remove"},settings:function(){var l=mpl.backbone.settings(this);l?l.data({after_callback:function(l){var t=mpl.get.model(l.data("button")),o=mpl.storage[t],n=e("#model-"+t),i="";void 0!=o.args.icon&&(i='<i class="'+o.args.icon+'"></i> '),e("#mpl-pmodel-"+t).html(i+mpl.tools.esc(o.args.title)),n.find(".mpl-vertical-label").html(i+mpl.tools.esc(o.args.title))}}):alert(mpl.__.i39)},double:function(l){var t=mpl.get.model(this),o=mpl.backbone.export(t),n=e(this).closest(".mpl-views-sections-wrap");n.find("> .mpl-views-sections-label .sl-active").removeClass("sl-active"),n.find("> .mpl-section-active").removeClass("mpl-section-active"),mpl.params.process_all(o.begin+o.content+o.end,n,"views_section")},remove:function(){var l=mpl.get.model(this),t=e("#mpl-pmodel-"+l).parent();confirm("Are you sure?")&&(e("#mpl-pmodel-"+l).remove(),t.find(".section-label").first().trigger("click"),delete mpl.storage[l],e("#model-"+l).remove())}}),row:(new mpl.backbone.views).extend({render:function(l,t){l.name="mpl_row",l.end="[/mpl_row]";var o=e(mpl.template("row",l.args)),n=' width="12/12"';if(void 0!==l.args&&void 0!==l.args.__section_link);else{var i=void 0!==l.args.content?l.args.content.toString().trim():"";if(0!==i.indexOf("[mpl_column")){i=(i=i.replace(/mpl_column#/g,"mpl_column##")).replace(/mpl_column /g,"mpl_column# ").replace(/mpl_column\]/g,"mpl_column#]");var l=mpl.params.merge("mpl_column");for(var s in l)void 0!==l[s]&&void 0!==l[s].value&&(n+=" "+l[s].name+'="'+mpl.tools.esc_attr(l[s].value)+'"');i="[mpl_column"+n+"]"+i+"[/mpl_column]",delete l}mpl.params.process_columns(i,o.find(".mpl-row-wrap"))}return _.isUndefined(t)&&e("#mpl-container>#mpl-rows").append(o),this.el=o,o},events:{".row-container-control .close:click":"remove",".row-container-control .settings:click":"edit",".row-container-control .double:click":"double",".row-container-control .copy:click":"copy",".row-container-control .columns:click":"columns",".row-container-control .collapse:click":"collapse",".row-container-control .addToSections:click":"sections",".row-container-control .rowStatus:click":"status",".row-container-control .order-row input:mouseover":"get_order",".row-container-control .order-row button:click":"order",".row-container-control .order-row input:keydown":"order_enter",".mpl-row-section-preview .select-another-section:click":"select_section"},columns:function(){var l=e(this).closest(".mpl-row").find(">.mpl-row-wrap>.mpl-column.mpl-model"),t=mpl.tools.popup.render(this,{title:"Row Layout",class:"no-footer",width:341,content:mpl.template("row-columns",{current:l.length}),help:"#"});t.find(".button").on("click",{model:mpl.get.model(this),columns:l,pop:t},mpl.views.row.set_columns),t.find("input[type=checkbox]").on("change",function(){var l=e(this).data("name");void 0!=l&&(1==this.checked?mpl.cfg[l]="checked":mpl.cfg[l]="",mpl.backbone.stack.set("MPL_Configs",mpl.cfg))})},set_columns:function(l){var t=e(this).data("column"),o=l.data.columns,n=e("#model-"+l.data.model+" > .mpl-row-wrap"),i=[],s=0;if("custom"==t){if(""===(t=e(this).parent().find("input").val())||-1===t.indexOf("%")&&-1===t.indexOf("/"))return void alert("Invalid value");if((t=t.split("+")).length>10)return void alert("Maximum 10 columns, you entered "+t.length+" columns");var a=0;for(s=0;s<t.length;s++)i[s]=t[s].trim(),i[s].indexOf("/")>-1?(i[s]=i[s].split("/"),i[s]=mpl.tools.nfloat(parseFloat(i[s][0])/parseFloat(i[s][1])*100)):i[s].indexOf("%")>-1&&(i[s]=parseFloat(i[s])),a+=parseFloat(i[s]);if(a>100||a<99)return void alert("\nTotal is incorrect: "+a+"%, it must be 100%\n");t=t.length}else for(t=parseInt(t),s=0;s<t;s++)i[s]=mpl.tools.nfloat(100/t);if(o.length<t)for(s=0;s<t-o.length;s++){var r=mpl.backbone.double(o.last().get(0));void 0!=e("#m-r-c-double-content").attr("checked")&&0!==o.length||r.find(".mpl-model").each(function(){delete mpl.storage[e(this).data("model")],e(this).remove()})}else for(s=0;s<o.length-t;s++){var m=!1;if(n.find(">.mpl-column.mpl-model,>.mpl-column-inner.mpl-model").each(function(){0==e(this).find(">.mpl-column-wrap>.mpl-model").length&&(m=this)}),0!=m)e(m).remove();else{var c=n.find(">.mpl-column.mpl-model,>.mpl-column-inner.mpl-model").last(),p=c.prev();void 0!=e("#m-r-c-keep-content").attr("checked")&&void 0!=p.get(0)?c.find(">.mpl-column-wrap>.mpl-model").each(function(){p.find(">.mpl-column-wrap").append(this)}):c.find(">.mpl-column-wrap>.mpl-model").each(function(){delete mpl.storage[e(this).data("model")]}),c.remove()}}s=0,o.eq(0).parent().find(">.mpl-model").each(function(){mpl.storage[e(this).data("model")].args.width=i[s]+"%",e(this).css({width:i[s]+"%"}).find(">.mpl-cols-info").html(Math.round(i[s])+"%"),s++}),l.data.pop.remove()},collapse:function(){var l=e(this).closest(".mpl-row"),t=mpl.get.model(this);l.hasClass("collapse")?(l.removeClass("collapse"),delete mpl.storage[t].args._collapse):(l.addClass("collapse"),mpl.storage[t].args._collapse="1")},sections:function(e){var l=mpl.get.model(e.target);mpl.cfg.sectionsType="mpl-section",mpl.sections={items:[]},mpl.views.builder.sections(e,{save_row:l})},copy:function(l){if(!e(this).hasClass("copied")){var t=mpl.get.model(this),o=mpl.backbone.export(t);mpl.backbone.stack.set("MPL_RowClipboard",o.begin+o.content+o.end),mpl.tools.toClipboard(o.begin+o.content+o.end),e(this).addClass("copied"),setTimeout(function(l){e(l).removeClass("copied")},600,this)}},edit:function(l){var t=mpl.backbone.settings(this);t?t.data({after_callback:function(l){var t=mpl.get.model(l.data("button")),o=mpl.storage[t].args,n="",i=e("#model-"+t+">.mpl-row-admin-view");void 0!=o.row_id&&"__empty__"!=o.row_id&&(n+="#"+o.row_id+" "),i.html(n)}}):alert(mpl.__.i41)},status:function(l){var t=mpl.get.model(this);void 0!==mpl.storage[t]&&void 0!==mpl.storage[t].args&&(e(this).hasClass("disabled")?(e(this).removeClass("disabled").closest(".mpl-model").removeClass("collapse"),delete mpl.storage[t].args.disabled):(e(this).addClass("disabled").closest(".mpl-model").addClass("collapse"),mpl.storage[t].args.disabled="on"),mpl.confirm(!0))},get_order:function(l){e(this).val(e("#mpl-rows>.mpl-row").index(e(this).closest(".mpl-row"))+1)},order:function(l){var t=e(this).closest(".mpl-row"),o=e("#mpl-rows>.mpl-row"),n=e(this).parent().find("input").val();return""===n||n<0||n>o.length?e(this).prev().animate({marginLeft:-20},150).animate({marginLeft:15},150).animate({marginLeft:-10},150).animate({marginLeft:5},150).animate({marginLeft:0},150):0==n||1==n?(o.first().before(t),mpl.ui.scrollAssistive(t.get(0),!0),e(this).parent().find("input").val("")):(o.index(t)<n-1?o.eq(n-1).after(t):o.eq(n-1).before(t),mpl.ui.scrollAssistive(t.get(0),!0),e(this).parent().find("input").val("")),l.preventDefault(),!1},order_enter:function(l){if(13==l.keyCode)return e(this).next().trigger("click"),l.preventDefault(),!1},select_section:function(l){var t=mpl.get.model(l.target),o=e(this).data("current");return mpl.views.builder.sections(l,{current:o,model:t}),l.preventDefault(),!1}}),column:(new mpl.backbone.views).extend({render:function(l){l.name="mpl_column",l.end="[/mpl_column]";var t=l.args.width;void 0!=t?t.toString().indexOf("/")>-1?(t=t.split("/"),t=parseFloat(t[0]/t[1]*100).toFixed(4)+"%"):-1===t.toString().indexOf("%")&&(t+="%"):t="100%";var o=e(mpl.template("column",{width:t}));return mpl.params.process_all(l.args.content,o.find(".mpl-column-wrap")),this.el=o,o},events:{">.mpl-column-control .edit:click":"settings",">.mpl-column-control .add:click":"add",">.mpl-column-control .delete:click":"delete",">.mpl-column-control .double:click":"double",">.mpl-column-control .insert:click":"insert"},delete:function(l,t){if(confirm(mpl.__.sure)){if(void 0==t)var t=mpl.get.model(this);var o=e("#model-"+t),n=o.parent();o.find(".mpl-model").each(function(){delete mpl.storage[mpl.get.model(this)]}),o.remove(),delete mpl.storage[t],mpl.views.column.reset_view(n)}},insert:function(l){"object"==typeof l&&(l=mpl.get.model(this));var t=e("#model-"+l),o=mpl.storage[l],n=e().extend(!0,{},o);if(t.parent().find(">.mpl-model").length>=10)alert(mpl.__.i54);else{n.args.content="";var i=mpl.views.column.render(n,!0);t.after(i),mpl.views.column.reset_view(t.parent()),mpl.ui.sortInit()}},reset_view:function(l){var t,o=l.find(">.mpl-model"),n=mpl.tools.nfloat(100/o.length);if(0===o.length)return delete mpl.storage[l.closest(".mpl-model").data("model")],void l.closest(".mpl-model").remove();o.each(function(){t=e(this).data("model"),mpl.storage[t].args.width=n+"%",e(this).css({width:n+"%"}),e(this).find(">.mpl-cols-info").html(n+"%")})},apply_all:function(l,t){var o=mpl.get.popup(l),n=o.data("model");o.find(".sl-check.sl-func").trigger("click");try{var i=mpl.storage[n].args[t];e("#model-"+n).parent().find(">div").each(function(){void 0!==(n=e(this).data("model"))&&(mpl.storage[n].args[t]=i)})}catch(e){}return event.preventDefault(),!1}}),mpl_row_inner:(new mpl.backbone.views).extend({render:function(l){l.name="mpl_row_inner",l.end="[/mpl_row_inner]";var t=e(mpl.template("row-inner")),o=l.args.content;return 0!==(o=void 0!==o?o.toString().trim():"").indexOf("[mpl_column")&&(o='[mpl_column_inner width="12/12"]'+o.replace(/mpl_column_inner/g,"mpl_column_inner#")+"[/mpl_column_inner]"),mpl.params.process_all(o,t.find(".mpl-row-wrap")),this.el=t,t},events:{".mpl-row-inner-control > .settings:click":"settings",".mpl-row-inner-control > .double:click":"double",".mpl-row-inner-control > .delete:click":"remove",".mpl-row-inner-control > .copyRowInner:click":"copy",".mpl-row-inner-control > .columns:click":"columns",".mpl-row-inner-control > .collapse:click":"collapse"},collapse:function(){var l=e("#model-"+mpl.get.model(this));l.hasClass("collapse")?l.removeClass("collapse"):l.addClass("collapse")},columns:function(){var l=e(this).closest(".mpl-row-inner").find(">.mpl-row-wrap>.mpl-column-inner.mpl-model"),t=mpl.tools.popup.render(this,{title:mpl.__.i42,class:"no-footer",width:341,content:mpl.template("row-columns",{current:l.length}),help:"#"});t.find(".button").on("click",{model:mpl.get.model(this),columns:l,pop:t},mpl.views.row.set_columns),t.find("input[type=checkbox]").on("change",function(){var l=e(this).data("name");void 0!=l&&(1==this.checked?mpl.cfg[l]="checked":mpl.cfg[l]="",mpl.backbone.stack.set("MPL_Configs",mpl.cfg))})},copy:function(){e(this).hasClass("copied")||(e(this).addClass("copied"),setTimeout(function(e){e.removeClass("copied")},1e3,e(this)),mpl.backbone.copy(this))}}),mpl_column_inner:(new mpl.backbone.views).extend({render:function(l){l.name="mpl_column_inner",l.end="[/mpl_column_inner]";var t=l.args.width;void 0!=t?t.toString().indexOf("/")>-1?t=(t=t.split("/"))[0]/t[1]*100+"%":-1===t.toString().indexOf("%")&&(t+="%"):t="100%";var o=e(mpl.template("column-inner",{width:t}));return void 0!==l.args.content&&""!=l.args.content&&mpl.params.process_all(l.args.content,o.find(".mpl-column-wrap")),this.el=o,o},events:{">.mpl-column-control .edit:click":"settings",">.mpl-column-control .add:click":"add",">.mpl-column-control .delete:click":"delete",">.mpl-column-control .double:click":"double",">.mpl-column-control .insert:click":"insert"},insert:function(l,t){var t=mpl.get.model(this),o=e("#model-"+t),n=mpl.storage[t],i=e().extend(!0,{},n);if(o.parent().find(">.mpl-model").length>=10)alert(mpl.__.i54);else{i.args.content="";var s=mpl.views.mpl_column_inner.render(i,!0);o.after(s),mpl.views.column.reset_view(o.parent()),mpl.ui.sortInit()}},delete:function(e){mpl.views.column.delete(e,mpl.get.model(this))}}),mpl_element:(new mpl.backbone.views).extend({render:function(l){var t=e().extend({},mpl.maps._std);t=e().extend(t,mpl.maps[l.name]);var o=e(mpl.template("element",{map:t,params:l}));return setTimeout(function(e,l,t){t.append(mpl.params.admin_label.render({map:l,params:e,el:t}))},parseInt(100*Math.random())+100,l,t,o),!0===t.nested&&mpl.params.process_all(l.args.content,o.find(".mpl-column-wrap")),this.el=o,o},events:{">.mpl-element-control .edit:click":"edit",">.mpl-element-control .delete:click":"remove",">.mpl-element-control .double:click":"double",">.mpl-element-control .add:click":"add",">.mpl-element-control .more:click":"more",">.mpl-element-control .copy:click":"copy",">.mpl-element-control .cut:click":"cut",">.mpl-element-control:click":function(l){var t=e(l.target);t.hasClass("more")||t.parent().hasClass("more")||e(this).find(".active").removeClass("active")}},edit:function(l){var t=mpl.backbone.settings(this);t?(e(this).closest(".mpl-element").addClass("editting"),t.data({cancel:function(l){e(l.data("button")).closest(".mpl-element").removeClass("editting")},after_callback:function(l){var t=mpl.get.model(l.data("button")),o=mpl.storage[t],n=e().extend({},mpl.maps._std),i=e("#model-"+t);n=e().extend(n,mpl.maps[o.name]),i.find(">.admin-view").remove(),i.append(mpl.params.admin_label.render({map:n,params:o,el:i}))}})):alert(mpl.__.i43)}}),mpl_undefined:(new mpl.backbone.views).extend({render:function(l){var t=e().extend({},mpl.maps._std);t=e().extend(t,mpl.maps[l.name]);var o=e(mpl.template("undefined",{map:t,params:l}));return this.el=o,o},events:{">.mpl-element-control .edit:click":"edit",">.mpl-element-control .delete:click":"remove",">.mpl-element-control .double:click":"double"},edit:function(l){var t=mpl.backbone.settings(this);t?(e(this).closest(".mpl-element").addClass("editting"),t.data({cancel:function(l){e(l.data("button")).closest(".mpl-element").removeClass("editting")},after_callback:function(l){e(l.data("button")).closest(".mpl-element").removeClass("editting");var t=mpl.get.model(l.data("button")),o=mpl.storage[t],n=e().extend({},mpl.maps._std),i=e("#model-"+t);n=e().extend(n,mpl.maps[o.name]),i.find(">.admin-view").remove(),i.append(mpl.params.admin_label.render({map:n,params:o,el:i}))}})):alert(mpl.__.i45)},remove:function(l){if(confirm(mpl.__.sure)){var t=e(this).closest("div.mpl-element"),o=t.data("model");t.remove(),delete mpl.storage[o]}}})})}(jQuery);